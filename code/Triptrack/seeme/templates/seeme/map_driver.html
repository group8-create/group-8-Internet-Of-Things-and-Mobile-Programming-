<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TripTrack</title>
    <!--    googlr fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;900&family=Ubuntu:wght@700&display=swap" rel="stylesheet">
    <!--    css style heet edited by suzy and diran-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
    <!--   fontawesome-->
    <script src="https://kit.fontawesome.com/2bb1598ed3.js" crossorigin="anonymous"></script>
    <!--    bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="{% static 'scripts/scripts.js' %}"></script>
    <style>
        #drivermap {
            height: 80vh;
            width: 100%;
        }
        body{
          overflow: hidden;
        }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    
    <section id="title">
        <div class="container-fluid" id="container-fluid">
            <!-- Nav Bar -->
            <nav class="navbar navbar-expand-lg navbar-dark" id="navbar" style="padding:0 0 5rem;">
                <div class="container-fluid">
                    <a class="navbar-brand d-flex" href="{% url 'home' %}">
                        <a class="navbar-brand" href="{% url 'home' %}">
                            <i class="fa-solid fa-location-dot fa-beat-fade fa-2xl" style="color: #f21c1c;"></i>
                            <i class="fa-solid fa-t fa-xl"></i>
                            <i class="fa-solid fa-r"></i>
                            <i class="fa-solid fa-i"></i>
                            <i class="fa-solid fa-p"></i>
                            <i class="fa-solid fa-t fa-xl" style="color: #f21c1c;"></i>
                            <i class="fa-solid fa-r" style="color: #f21c1c;"></i>
                            <i class="fa-solid fa-a" style="color: #f21c1c;"></i>
                            <i class="fa-solid fa-c" style="color: #f21c1c;">
                                <i class="fa-solid fa-k" style="color: #f21c1c;"></i>
                            </i>
                        </a>
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span> 
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item">
                                <a class="nav-link active header-text" aria-current="page" href="{% url 'home' %}"><u>HOME</u></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active header-text" href="{% url 'driver' %}">DRIVER</a>
                            </li>
                            <li class="nav-item">
                                {% if test == 1%}
                                <button type="button" class="btn btn-outline-primary btn-sm signup header-text" onclick="showLoginPopup()">
                                    <i class="fa-solid fa-user-lock" style="color: #28269c;"></i>login
                                </button>
                                {% else %}
                                {% endif %}
                            </li>
                            <li class="nav-item">
                                <button type="button" class="btn btn-success btn-sm login header-text" onclick="">
                                    <i class = "fa-solid fa-user-plus"></i>LOGOUT
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- mobile header -->
            <div class=" container-fluid " id="mobile-header">
            
                <nav id="sidebar">
                    <div class="sidebar-header" >
                        <a class="navbar-brand d-flex" href="{% url 'home' %}">
                            <a class="navbar-brand" href="{% url 'home' %}">
                                <i class="fa-solid fa-location-dot fa-beat-fade fa-2xl" style="color: #f21c1c;"></i>
                                <i class="fa-solid fa-t fa-lg" style="color: #00183b;"></i>
                                <i class="fa-solid fa-r" style="color: #00183b;"></i>
                                <i class="fa-solid fa-i" style="color: #00183b;"></i>
                                <i class="fa-solid fa-p" style="color: #00183b;"></i>
                                <i class="fa-solid fa-t fa-xl" style="color: #f21c1c;"></i>
                                <i class="fa-solid fa-r" style="color: #f21c1c;"></i>
                                <i class="fa-solid fa-a" style="color: #f21c1c;"></i>
                                <i class="fa-solid fa-c" style="color: #f21c1c;">
                                    <i class="fa-solid fa-k" style="color: #f21c1c;"></i>
                                </i>
                            </a>
                        </a>
                    </div>
                    <ul class="list-unstyled components">
                        <li class="nav-item con">
                            <a class="nav-link active header-text-mobile" aria-current="page" href="{% url 'home' %}"><u>HOME</u></a>
                        </li>
                        {% if test == 0%}
                        <li class="nav-item con">
                            <a class="nav-link active header-text-mobile" href="{% url 'driver' %}">DRIVER</a>
                        </li>
                        {% endif %}
                        <li class="nav-item con">
                            <a  href="{% url 'map' %}" class="nav-link active header-text-mobile">Safty measures</a>
                        </li>
                        <ul class="list-unstyled components">
                          <li class="nav-item con" style="">
                            <a  href="" class="nav-link active header-text-mobile">settings</a>
                        </li>
                        
                        
                    </ul>
                    <ul style="padding-top: 100%;">
                      {% if test  == 0%}
                      <button type="button" class="btn btn-outline-primary btn-sm signup header-text-mobile" onclick="showLoginPopup()">
                          <i class="fa-solid fa-user-lock" style="color: #28269c;"></i>LOGIN
                      </button>
                      {%endif%}
                      {% if test == 1%}
                      <form action="{% url 'logout' %} " method="post">
                          {% csrf_token %}
                      <button type="submit" style="color: #ff0606; border-color: #ff0606; font-weight: bolder;" class="btn btn-outline-primary btn-lg signup header-text-mobile">
                          <i class="fa-solid fa-user-lock" style="color: #28269c;"></i>LOGOUT
                      </button>
                      </form>
                      {% endif%}
                        
                    </ul>
                  
                </nav>
                <div id="content">
                    <div style="padding-top: -5%; align-items: start;">
                        <span><p>
                            <a class="navbar-brand d-flex" href="#">
                                <a class="navbar-brand" href="#">
                                    <i class="fa-solid fa-location-dot fa-beat-fade fa-2xl" style="color: #f21c1c;"></i>
                                    <i class="fa-solid fa-t fa-lg" style="color: #00183b;"></i>
                                    <i class="fa-solid fa-r" style="color: #00183b;"></i>
                                    <i class="fa-solid fa-i" style="color: #00183b;"></i>
                                    <i class="fa-solid fa-p" style="color: #00183b;"></i>
                                    <i class="fa-solid fa-t fa-xl" style="color: #f21c1c;"></i>
                                    <i class="fa-solid fa-r" style="color: #f21c1c;"></i>
                                    <i class="fa-solid fa-a" style="color: #f21c1c;"></i>
                                    <i class="fa-solid fa-c" style="color: #f21c1c;">
                                    <i class="fa-solid fa-k" style="color: #f21c1c;"></i>
                                    </i>
                                </a>
                            </a>    
                        </p></span>
                    </div>
                    <div type="button" id="sidebarCollapse">
                        <i class=""></i>
                        <span><i class="fa-solid fa-bars fa-2xl" style="color: #040c1b;"></i></span>
                    </div>
                </div>
            </div>
    
        </div>
    </section>
    
   <div id="drivermap"></div>
  <div id="locationInfo"></div>
  <"your API key">
      <script>
        var map;
        var directionsService;
        var directionsRenderer;
        var driverMarker;
        var currentRoute;
      
        function initializeMap() {
          // Create a new map instance
          map = new google.maps.Map(document.getElementById('drivermap'), {
            zoom: 15 // Set the initial zoom level
          });
      
          directionsService = new google.maps.DirectionsService();
          directionsRenderer = new google.maps.DirectionsRenderer({
            map: map
          });
      
          // Get the driver's current location
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var driverLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };
      
              // Center the map around the driver's location
              map.setCenter(driverLocation);
      
              // Add a marker at the driver's location
              driverMarker = new google.maps.Marker({
                position: driverLocation,
                map: map,
                title: 'My Location',
                icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 10, 
                  fillColor: '#007Acc',
                  fillOpacity: 1,
                  strokeWeight: 1
                }
              });
      
              // Additional map customization and functionality can be added here
      
              var passengerData = JSON.parse('{{ datapassenger |safe }}');
              for (var i = 0; i < passengerData.length; i++) {
                var lat = passengerData[i].lat;
                var lng = passengerData[i].lng;
                var des = passengerData[i].des;
      
                // Create a marker for each location in the passengerData
                var passengerMarker = new google.maps.Marker({
                  position: { lat: lat, lng: lng },
                  map: map,
                  title: des,
                  label: {
                    text: des,
                    color: 'red',
                    fontWeight: 'bold',
                    fontSize: '15px',
                  },
                  labelAnchor: new google.maps.Point(0, -20),
                  icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10, 
                    fillColor: '#38E54D',
                    fillOpacity: 1,
                    strokeWeight: 1
                  }
                });
      
                // Add click event listener to each passenger marker
                passengerMarker.addListener('click', function(event) {
                  calculateAndDisplayRoute(event.latLng);
                });
      
                // Additional customization for each marker can be added here
              }
      
            }, function() {
              // Handle geolocation error
              alert('Error: The Geolocation service failed.');
            });
          } else {
            // Browser doesn't support geolocation
            alert('Error: Your browser doesn\'t support geolocation.');
          }
        }
      
        function calculateAndDisplayRoute(destination) {
          if (currentRoute) {
            // Remove the previous route from the map
            currentRoute.setMap(null);
          }
      
          var request = {
            origin: driverMarker.getPosition(),
            destination: destination,
            travelMode: 'WALKING'
          };
      
          directionsService.route(request, function(result, status) {
            if (status == 'OK') {
              // Display the new route on the map
              currentRoute = new google.maps.Polyline({
                path: result.routes[0].overview_path,
                strokeColor: 'blue',
                strokeWeight: 8,
                strokeOpacity: 0.3,
                map: map
              });
      
              // Update the directionsRenderer to show the driving route
              directionsRenderer.setDirections(result);
            } else {
              alert('Error: Unable to find a route.');
            }
          });
        }
      
        // Call the initializeMap function when the page loads
        document.addEventListener('DOMContentLoaded', initializeMap);
      </script>
      
      
      
      
  <script>
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition);
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }
    
      function showPosition(position) {
        var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({'location': latlng}, function(results, status) {
          if (status === 'OK') {
            if (results[0]) {
              var address = results[0].formatted_address;
              document.getElementById("location-form").value = address;
            } else {
              alert('No results found');
            }
          } else {
            alert('Geocoder failed due to: ' + status);
          }
        });
      }
    </script>
    <script>
    function saveLocationInfo(destinationName, latitude,longitude) {
      // Send an HTTP POST request to the Django server
      const xhr = new XMLHttpRequest();
      const url = '/my-django-view/${pk}/';
      xhr.open('POST', url);
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onload = function() {
        if (xhr.status === 200) {
          console.log('Location information saved successfully.');
        } else {
          console.log('An error occurred while saving the location information.');
        }
      };
      const data = JSON.stringify({
        'destination_name': destinationName,
        'latitude': latitude,
        'longitude': longitude
      });
      xhr.send(data);
    }
  </script>
    <form action="" method="post">
      {% csrf_token %}
      <div class="d-flex justify-content-center">
      <button type="button" class="btn btn-primary mx-auto my-4 d-none" id="myButton">confirm Destination</button>
      </div>
  <footer class="footer" id="footer">
      
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'scripts/scripts.js' %}"></script>
  <script>
  $(document).ready(function() {
      var screenWidth = $(window).width();
      var sidebar = $('#sidebar');
      var content = $('#content');
  
      if (screenWidth >= 768) {
          sidebar.removeClass('active'); // Hide the sidebar on desktop screens
          content.removeClass('active');
      }
  
      $(window).scroll(function() {
          if (screenWidth < 768) {
              sidebar.removeClass('active');
              content.removeClass('active');
          }
      });
  
      $('#sidebarCollapse').on('click', function() {
          sidebar.toggleClass('active');
          content.toggleClass('active');
      });
  });
  
  </script>

</body>
</html>
